<% last_user = nil %>
<% @messages.each do |message| %>
    <% if message.body %>
        <% user = User.find(message.user_id) %>
          
        <% if current_user.username.eql? user.username %>
            <div style="text-align:right">
                <% if !last_user.eql? user.username %>
                  <div style="text-align:center">
                     <small class="text-muted message-date"><%= message.message_time %></small> 
                  </div>
                  <b class="message-username"> <%= user.username %></b>
                  <% last_user = user.username %>
                <% end %>
                <div class="message-container" id="message-right">
                    <div class="message" id="curr-message"><%= message.body %></div>
                </div>
            </div>
            
        <% else %>
            <div>
                <% if !last_user.eql? user.username %>
                  <div style="text-align:center">
                     <small class="text-muted message-date"><%= message.message_time %></small> 
                  </div>
                  <b class="message-username"> <%= user.username %></b>
                  <% last_user = user.username %>
                <% end %>
                <div class="message-container">
                    <div class="message" id="other-message"><%= message.body %></div>
                </div>
            </div>
            
        <% end %>
    <% end %>
<% end %>